<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Dashboard - EVibe</title>
    <link rel="stylesheet" href="../css/organizer.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<?php 
session_start();
if (!isset($_SESSION['user_id'])) {
    header("Location: login.html");
    exit();
}
?>
<script>
    window.currentUserId = <?php echo json_encode($_SESSION['user_id']); ?>;
    console.log('Current User ID:', window.currentUserId);
</script>
    <!-- Background Container -->
    <div class="background-container"></div>

    <div class="main-1">
        <div class="Nav-1">
            <h1>EVibe</h1>
            
            <div class="Search-bar">
                <input type="text" name="search" id="srch" placeholder="Search events...">
                <button id="searchButton" class="search-button"><i class="fas fa-search"></i></button>
            </div>
            
            <div class="Nav-Element">
                <ul>
                    <a href="user_panel.html"><li id="home">Home</li></a>
                    <li class="dropdown" id="categories">
                        <a href="javascript:void(0)" class="dropdown-toggle">Categories <i class="fas fa-chevron-down"></i></a>
                        <div class="dropdown-content" id="categoryDropdown">
                            <!-- Categories will be loaded here -->
                            <div class="loading-indicator">
                                <i class="fas fa-spinner fa-pulse"></i>
                                <p>Loading categories...</p>
                            </div>
                        </div>
                    </li>
                    <a href="Booked_event.html"><li id="booked">Booked Events</li></a>
                    <a href="favorites.html"><li id="favorites">Favorites</li></a>
                    <a href="history.html"><li id="history">History</li></a>
                    <a href="nearby_events.html"><li id="nearby">Nearby Events</li></a>
                </ul>
            </div>

            

          

            <button class="btn-logout" id="logoutBtn">Logout</button>
        </div>

        <div class="Name">
            <h1>Welcome <span id="userFullName">User</span></h1>
        </div>

        <!-- Image Carousel Slider -->
        <div class="carousel-container">
            <div class="carousel-slider" id="imageCarousel">
                <!-- Carousel images will be loaded here -->
                <div class="carousel-loading">
                    <i class="fas fa-spinner fa-pulse"></i>
                    <p>Loading featured images...</p>
                </div>
            </div>
            <button class="carousel-btn prev-btn" id="prevBtn"><i class="fas fa-chevron-left"></i></button>
            <button class="carousel-btn next-btn" id="nextBtn"><i class="fas fa-chevron-right"></i></button>
            <div class="carousel-dots" id="carouselDots"></div>
        </div>

        <h2 id="dashboard-txt">Dashboard</h2>
        <div class="dashboard">
            <div class="booked-events">
                <img id="dash-1" src="../images/ticket.png" alt="bookedevents">
                <h3>Booked Events</h3>
                <p id="totalBooked">0</p>
            </div>
            <div class="all-events">
                <img id="dash-3" src="../images/calendar.png" alt="all events">
                <h3>All Events</h3>
                <p id="totalEvents">0</p>
            </div>
        </div>

        <div class="featured-events">
            <h2>Featured Events</h2>
            <div id="featuredEventsContainer" class="event-grid">
                <!-- Featured events will be loaded here -->
            </div>
        </div>

        <div class="trending-events">
            <h2>Trending Events</h2>
            <div id="trendingEventsContainer" class="event-grid">
                <!-- Trending events will be loaded here -->
            </div>
        </div>

        <div class="Manage-events">
            <h2 id="manage-text">Quick Actions</h2>
            <div class="cards-container">
                <div class="card">
                    <i class="fas fa-calendar-check card-icon"></i>
                    <h3>Booked Events</h3>
                    <p>View and manage your booked events</p>
                    <div class="card-stats">
                        <span><i class="fas fa-ticket-alt"></i> View Bookings</span>
                    </div>
                    <a href="booked_events.html" class="card-link">View Bookings</a>
                </div>
                <div class="card">
                    <i class="fas fa-heart card-icon"></i>
                    <h3>Favorite Events</h3>
                    <p>View your favorite events</p>
                    <div class="card-stats">
                        <span><i class="fas fa-heart"></i> View Favorites</span>
                    </div>
                    <a href="favorites.html" class="card-link">View Favorites</a>
                </div>
                <div class="card">
                    <i class="fas fa-calendar-alt card-icon"></i>
                    <h3>All Events</h3>
                    <p>Browse all available events</p>
                    <div class="card-stats">
                        <span><i class="fas fa-search"></i> Browse Events</span>
                    </div>
                    <a href="all_events.html" class="card-link">Browse Events</a>
                </div>
            </div>
        </div>

        <div class="Chat">
            <div class="chat-header">
                <h2><i class="fas fa-comments"></i> Recent Messages</h2>
                <span id="messageBadge" class="chat-badge">0 New</span>
            </div>
            <div id="recentMessages" class="chat-messages">
                <!-- Recent messages will be loaded here -->
                <div class="loading-messages">
                    <i class="fas fa-spinner fa-pulse"></i>
                    <p>Loading messages...</p>
                </div>
            </div>
            <a href="chat.html" class="chat-link">View All Messages</a>
        </div>

        <footer class="footer">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>About EVibe</h3>
                    <p>Your one-stop platform for event management and ticket booking.</p>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="#">Help Center</a></li>
                        <li><a href="#">Terms of Service</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="#">Contact Us</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Connect With Us</h3>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-linkedin"></i></a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 EVibe. All rights reserved.</p>
            </div>
        </footer>
    </div>

    <!-- Add message modal HTML -->
    <div id="messageModal" class="modal">
        <div class="modal-content">
            <div class="chat-header">
                <span class="close" id="closeMessageModal">&times;</span>
                <h2>Chat Messages</h2>
                <div class="chat-info">
                    <span id="chatEventTitle">Event: Loading...</span>
                    <span id="chatEventDate">Date: Loading...</span>
                </div>
            </div>
            <div class="chat-container">
                <div id="chatMessages" class="chat-messages">
                    <!-- Messages will be loaded here -->
                </div>
                <div class="chat-input-container">
                    <form id="messageForm">
                        <input type="hidden" id="eventId" name="eventId">
                        <textarea id="messageText" placeholder="Type your message here..." required></textarea>
                        <button type="submit" class="send-btn">
                            <i class="fas fa-paper-plane"></i> Send
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global function for creating event cards
        function createEventCard(event) {
            let imageUrl = event.image_url;
            
            // Handle image URL like in organizer.html
            if (imageUrl && !imageUrl.startsWith('/kaif_evibe/')) {
                // If it's a relative path, make it absolute
                if (!imageUrl.startsWith('/')) {
                    imageUrl = '/kaif_evibe/templates/' + imageUrl;
                } else {
                    imageUrl = '/kaif_evibe' + imageUrl;
                }
            }

            // If no image URL is provided, use default image
            if (!imageUrl) {
                imageUrl = '/kaif_evibe/templates/images/default-event.jpg';
            }

            return `
                <div class="event-card">
                    <div class="event-image-container">
                        <img src="${imageUrl}" alt="${event.title}" class="event-image">
                        <button class="favorite-btn" onclick="toggleFavorite(${event.event_id})" data-event-id="${event.event_id}">
                            <img src="/kaif_evibe/templates/images/heart.png" alt="Favorite" class="favorite-icon">
                        </button>
                    </div>
                    <div class="event-content">
                        <div class="event-title-container">
                            <h3 class="event-title">${event.title}</h3>
                            
                        </div>
                        <div class="event-info">
                            <p><i class="fas fa-calendar"></i> ${event.formatted_date}</p>
                            <p><i class="fas fa-map-marker-alt"></i> ${event.venue}</p>
                            <p><i class="fas fa-tag"></i> ${event.category}</p>
                            <p><i class="fas fa-user"></i> Organizer: ${event.organizer_name || 'Unknown'}</p>
                            <p><i class="fas fa-star"></i> ${event.rating} (${event.rating_count} reviews)</p>
                            <p id="User-price"><i class="fas fa-ticket-alt"></i> <span id="price-kaif">Price: </span>$${event.price}</p>
                        </div>
                        <div class="event-actions">
                            <button class="btn-book" onclick="bookEvent(${event.event_id})">
                                <i class="fas fa-ticket-alt"></i> Book
                            </button>
                            <button class="btn-view" onclick="viewEvent(${event.event_id})">
                                <i class="fas fa-eye"></i> View
                            </button>
                            <button class="message-btn" onclick="messageOrganizer(${event.event_id})">
                                <i class="fas fa-comments"></i> Messages
                                <span class="unread-badge" id="unread-${event.event_id}">0</span>
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Load dashboard stats
        function loadDashboardStats() {
            $.ajax({
                url: '/kaif_evibe/templates/php/get_user_stats.php',
                method: 'GET',
                success: function(response) {
                    if (response.success) {
                        $('#totalBooked').text(response.total_bookings || '0');
                        $('#totalEvents').text(response.upcoming_events || '0');
                    } else {
                        console.error('Error loading stats:', response.message);
                    }
                },
                error: function(xhr, status, error) {
                    console.error('Error loading stats:', error);
                }
            });
        }

        $(document).ready(function() {
            // Check session status
            function checkSession() {
                $.ajax({
                    url: '/kaif_evibe/templates/php/check_session.php',
                    method: 'GET',
                    success: function(response) {
                        if (!response.logged_in) {
                            window.location.href = 'login.html';
                            return;
                        }
                        
                        // Update user information
                        $('#userFullName').text(response.name || 'User');
                        $('#userName').text(response.name || 'User');
                        
                        // Load dashboard stats
                        loadDashboardStats();
                        
                        // Load carousel images
                        loadCarouselImages();
                        
                        // Load events - load all events first, don't let categories override
                        loadFeaturedEvents();
                        loadTrendingEvents();
                        
                        // Load categories in both dropdown and categories section,
                        // but don't auto-show first category to avoid overriding all events
                        loadCategoriesInDropdown();
                        loadCategoriesSectionOnly();
                    },
                    error: function() {
                        window.location.href = 'login.html';
                    }
                });
            }

            // Load carousel images
            function loadCarouselImages() {
                $.ajax({
                    url: '/kaif_evibe/templates/php/get_carousel_images.php',
                    method: 'GET',
                    success: function(response) {
                        if (response.success && response.images && response.images.length > 0) {
                            initCarousel(response.images);
                        } else {
                            // Fallback to default images if no images in database
                            const defaultImages = [
                                {
                                    image_url: '../images/default-event.jpg',
                                    title: 'Upcoming Events',
                                    description: 'Discover exciting events happening near you'
                                },
                                {
                                    image_url: '../images/music.jpeg',
                                    title: 'Music Festivals',
                                    description: 'Experience the best music festivals this season'
                                },
                                {
                                    image_url: '../images/cricket.jpeg',
                                    title: 'Sports Events',
                                    description: 'Don\'t miss out on thrilling sports action'
                                }
                            ];
                            initCarousel(defaultImages);
                        }
                    },
                    error: function(xhr, status, error) {
                        console.error('Error loading carousel images:', error);
                        // Fallback to default images on error
                        const defaultImages = [
                            {
                                image_url: '../images/default-event.jpg',
                                title: 'Upcoming Events',
                                description: 'Discover exciting events happening near you'
                            },
                            {
                                image_url: '../images/music.jpeg',
                                title: 'Music Festivals',
                                description: 'Experience the best music festivals this season'
                            },
                            {
                                image_url: '../images/cricket.jpeg',
                                title: 'Sports Events',
                                description: 'Don\'t miss out on thrilling sports action'
                            }
                        ];
                        initCarousel(defaultImages);
                    }
                });
            }

            // Initialize carousel with images
            function initCarousel(images) {
                const carousel = $('#imageCarousel');
                const dotsContainer = $('#carouselDots');
                
                // Clear loading and any existing content
                carousel.empty();
                dotsContainer.empty();
                
                // Add slides to carousel
                images.forEach((image, index) => {
                    const slide = $(`
                        <div class="carousel-slide" data-index="${index}">
                            <a href="/kaif_evibe/templates/html/View_Event.html?id=${image.event_id || ''}" class="carousel-link">
                                <img src="${image.image_url}" alt="${image.title || 'Slider Image'}">
                                <div class="carousel-caption">
                                    <h3>${image.title || 'Featured Event'}</h3>
                                    <p>${image.description || 'Check out this exciting event'}</p>
                                </div>
                            </a>
                        </div>
                    `);
                    
                    carousel.append(slide);
                    
                    // Add dot for this slide
                    const dot = $(`<div class="carousel-dot ${index === 0 ? 'active' : ''}" data-index="${index}"></div>`);
                    dotsContainer.append(dot);
                });
                
                // Set up carousel functionality
                let currentIndex = 0;
                const slideCount = images.length;
                
                // Show first slide
                updateCarousel();
                
                // Auto-play carousel
                let autoplayInterval = setInterval(nextSlide, 5000);
                
                // Navigation button handlers
                $('#prevBtn').on('click', function() {
                    prevSlide();
                    resetAutoplay();
                });
                
                $('#nextBtn').on('click', function() {
                    nextSlide();
                    resetAutoplay();
                });
                
                // Dot navigation
                $('.carousel-dot').on('click', function() {
                    currentIndex = parseInt($(this).data('index'));
                    updateCarousel();
                    resetAutoplay();
                });
                
                // Pause autoplay on hover
                $('.carousel-container').hover(
                    function() { clearInterval(autoplayInterval); },
                    function() { autoplayInterval = setInterval(nextSlide, 5000); }
                );
                
                // Touch swipe support
                let touchStartX = 0;
                let touchEndX = 0;
                
                $('.carousel-container').on('touchstart', function(e) {
                    touchStartX = e.originalEvent.touches[0].clientX;
                }).on('touchend', function(e) {
                    touchEndX = e.originalEvent.changedTouches[0].clientX;
                    handleSwipe();
                });
                
                function handleSwipe() {
                    if (touchStartX - touchEndX > 50) {
                        // Swipe left
                        nextSlide();
                        resetAutoplay();
                    } else if (touchEndX - touchStartX > 50) {
                        // Swipe right
                        prevSlide();
                        resetAutoplay();
                    }
                }
                
                function nextSlide() {
                    currentIndex = (currentIndex + 1) % slideCount;
                    updateCarousel();
                }
                
                function prevSlide() {
                    currentIndex = (currentIndex - 1 + slideCount) % slideCount;
                    updateCarousel();
                }
                
                function updateCarousel() {
                    // Update slide position
                    carousel.css('transform', `translateX(-${currentIndex * 100}%)`);
                    
                    // Update dots
                    $('.carousel-dot').removeClass('active');
                    $(`.carousel-dot[data-index="${currentIndex}"]`).addClass('active');
                }
                
                function resetAutoplay() {
                    clearInterval(autoplayInterval);
                    autoplayInterval = setInterval(nextSlide, 5000);
                }
            }

            // Load featured events
            function loadFeaturedEvents() {
                $.ajax({
                    url: '/kaif_evibe/templates/php/get_all_events.php',
                    method: 'GET',
                    success: function(response) {
                        if (response.success && response.events) {
                            const events = response.events;
                            const container = $('#featuredEventsContainer');
                            container.empty();
                            
                            // Update the title to "All Events"
                            $('.featured-events h2').text('All Events');
                            
                            const $grid = $('<div class="event-grid"></div>');
                            events.forEach(event => {
                                $grid.append(createEventCard(event));
                                checkFavoriteStatus(event.event_id);
                            });
                            container.append($grid);
                        } else {
                            console.error('Error loading events:', response.message || 'Unknown error');
                            $('#featuredEventsContainer').html('<p class="error-message">Error loading events. Please try again later.</p>');
                        }
                    },
                    error: function(xhr, status, error) {
                        console.error('Error:', error);
                        console.error('Status:', status);
                        console.error('Response:', xhr.responseText);
                        $('#featuredEventsContainer').html('<p class="error-message">Error loading events. Please try again later.</p>');
                    }
                });
            }

            // Load trending events
            function loadTrendingEvents() {
                $.ajax({
                    url: '/kaif_evibe/templates/php/get_trending_events.php',
                    method: 'GET',
                    success: function(response) {
                        if (response.success && response.events) {
                            const events = response.events;
                            const container = $('#trendingEventsContainer');
                            container.empty();
                            
                            const $grid = $('<div class="event-grid"></div>');
                            events.forEach(event => {
                                $grid.append(createEventCard(event));
                                checkFavoriteStatus(event.event_id);
                            });
                            container.append($grid);
                        } else {
                            console.error('Error loading trending events:', response.message || 'Unknown error');
                            $('#trendingEventsContainer').html('<p class="error-message">Error loading events. Please try again later.</p>');
                        }
                    },
                    error: function(xhr, status, error) {
                        console.error('Error:', error);
                        console.error('Status:', status);
                        console.error('Response:', xhr.responseText);
                        $('#trendingEventsContainer').html('<p class="error-message">Error loading events. Please try again later.</p>');
                    }
                });
            }

            // Search functionality
            let searchTimeout;
            $('#srch').on('input', function() {
                const searchTerm = $(this).val().trim();
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(function() {
                    if (searchTerm.length >= 2) {
                        handleSearch();
                    }
                }, 300);
            });

            $('#searchButton').on('click', function() {
                const searchTerm = $('#srch').val().trim();
                if (searchTerm.length > 0) {
                    window.location.href = `search_results.html?q=${encodeURIComponent(searchTerm)}`;
                }
            });

            // Logout functionality
            $('#logoutBtn').on('click', function() {
                $.ajax({
                    url: '/kaif_evibe/templates/php/logout.php',
                    method: 'POST',
                    success: function() {
                        window.location.href = 'login.html';
                    }
                });
            });

            // Initial session check
            checkSession();

            // Check favorite status for all events when page loads
            $('.favorite-btn').each(function() {
                const eventId = $(this).data('event-id');
                checkFavoriteStatus(eventId);
            });

            // Update dropdown click handlers
            $('.dropdown-toggle').on('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                const dropdown = $(this).closest('.dropdown').find('.dropdown-content');
                dropdown.toggleClass('show');
            });

            // Close dropdown when clicking outside
            $(document).on('click', function(e) {
                if (!$(e.target).closest('.dropdown').length) {
                    $('.dropdown-content').removeClass('show');
                }
            });

            // Prevent dropdown from closing when clicking inside
            $('.dropdown-content').on('click', function(e) {
                e.stopPropagation();
            });

            // Handle category tab clicks
            $(document).on('click', '.category-tab', function() {
                const category = $(this).data('category');
                if (category) {
                    // Update active tab
                    $('.category-tab').removeClass('active');
                    $(this).addClass('active');
                    
                    // Show corresponding events
                    showCategoryEvents(category);
                }
            });

            // Load just the category tabs without showing events
            function loadCategoriesSectionOnly() {
                console.log('Loading category tabs only...');
                $.ajax({
                    url: '/kaif_evibe/templates/php/get_categories_with_events.php',
                    method: 'GET',
                    success: function(response) {
                        console.log('Categories response:', response);
                        if (response.success && response.categories) {
                            const categories = response.categories;
                            console.log('Categories found:', categories);
                            const $categoriesScroll = $('.categories-scroll');
                            
                            // Clear existing content
                            $categoriesScroll.empty();
                            
                            // Add "All Events" tab first
                            const allEventsTab = $(`
                                <div class="category-tab active" 
                                     data-category='${JSON.stringify({name: 'All Events', events: response.all_events || []})}'>
                                    <i class="fas fa-th-large"></i>
                                    <span>All Events</span>
                                    <span class="event-count">${response.total_events || 0}</span>
                                </div>
                            `);
                            $categoriesScroll.append(allEventsTab);
                            
                            // Create category tabs
                            categories.forEach((category) => {
                                console.log('Creating tab for category:', category);
                                const $tab = $(`
                                    <div class="category-tab" 
                                         data-category='${JSON.stringify(category)}'>
                                        <i class="${category.icon || 'fas fa-tag'}"></i>
                                        <span>${category.name}</span>
                                        <span class="event-count">${category.event_count || 0}</span>
                                    </div>
                                `);
                                
                                $categoriesScroll.append($tab);
                            });
                        } else {
                            console.error('Error in categories response:', response);
                            $('.categories-scroll').html('<p class="error-message">Error loading categories</p>');
                        }
                    },
                    error: function(xhr, status, error) {
                        console.error('Error loading categories:', error);
                        console.error('Status:', status);
                        console.error('Response:', xhr.responseText);
                        $('.categories-scroll').html('<p class="error-message">Error loading categories</p>');
                    }
                });
            }

            // Profile image upload functionality
            $('#profileImageUpload').on('change', function() {
                const file = this.files[0];
                if (file) {
                    const formData = new FormData();
                    formData.append('profile_image', file);

                    // Show loading state
                    $('#profilePic').addClass('loading');
                    
                    $.ajax({
                        url: '/kaif_evibe/templates/php/update_profile_image.php',
                        method: 'POST',
                        data: formData,
                        processData: false,
                        contentType: false,
                        success: function(response) {
                            if (response.success) {
                                // Update profile image
                                $('#profilePic').attr('src', response.image_url);
                                showNotification('Profile image updated successfully!', 'success');
                            } else {
                                showNotification(response.message || 'Failed to update profile image', 'error');
                            }
                        },
                        error: function(xhr, status, error) {
                            console.error('Error:', error);
                            showNotification('Error updating profile image', 'error');
                        },
                        complete: function() {
                            // Remove loading state
                            $('#profilePic').removeClass('loading');
                        }
                    });
                }
            });

            // Function to display recent messages
            function displayRecentMessages(messages) {
                const container = $('#recentMessages');
                container.empty();
                
                if (!messages || messages.length === 0) {
                    container.html(`
                        <div class="no-messages">
                            <i class="fas fa-comment-slash"></i>
                            <p>No messages yet</p>
                        </div>
                    `);
                    return;
                }
                
                messages.forEach(message => {
                    const isUnread = !message.is_read && message.receiver_id === window.currentUserId;
                    const messageClass = isUnread ? 'message-unread' : '';
                    
                    container.append(`
                        <div class="message-preview ${messageClass}" data-event-id="${message.event_id}">
                            <div class="message-header">
                                <span class="sender-name">${message.sender_name || 'Unknown'}</span>
                                <span class="message-time">${formatMessageTime(message.created_at)}</span>
                            </div>
                            <div class="message-content">
                                <p class="event-title">${message.event_title || 'No Event'}</p>
                                <p class="message-text">${message.message || ''}</p>
                            </div>
                        </div>
                    `);
                });
            }

            // Function to load recent messages
            function loadRecentMessages() {
                if (!window.currentUserId) {
                    console.error('User ID not available');
                    return;
                }

                $.ajax({
                    url: '/kaif_evibe/templates/php/chat_ajax.php',
                    method: 'POST',
                    data: {
                        action: 'get_messages',
                        limit: 5
                    },
                    success: function(response) {
                        if (response.success) {
                            displayRecentMessages(response.messages);
                            updateUnreadCount();
                        } else {
                            console.error('Error loading messages:', response.message);
                        }
                    },
                    error: function(xhr, status, error) {
                        console.error('Error loading messages:', error);
                    }
                });
            }

            // Function to update unread message count
            function updateUnreadCount() {
                $.ajax({
                    url: '/kaif_evibe/templates/php/chat_ajax.php',
                    method: 'POST',
                    data: {
                        action: 'get_unread_count'
                    },
                    success: function(response) {
                        if (response.success) {
                            const badge = $('#messageBadge');
                            if (response.count > 0) {
                                badge.text(`${response.count} New`);
                                badge.show();
                            } else {
                                badge.hide();
                            }
                        }
                    }
                });
            }

            // Function to format message time
            function formatMessageTime(timestamp) {
                const date = new Date(timestamp);
                const now = new Date();
                const diff = now - date;
                
                if (diff < 60000) { // Less than 1 minute
                    return 'Just now';
                } else if (diff < 3600000) { // Less than 1 hour
                    const minutes = Math.floor(diff / 60000);
                    return `${minutes}m ago`;
                } else if (diff < 86400000) { // Less than 1 day
                    const hours = Math.floor(diff / 3600000);
                    return `${hours}h ago`;
                } else {
                    return date.toLocaleDateString();
                }
            }

            // Load messages when the page loads
            $(document).ready(function() {
                console.log('Document ready, currentUserId:', window.currentUserId);
                
                // Load categories in dropdown
                loadCategoriesInDropdown();
                
                // Load featured events initially
                loadFeaturedEvents();
                
                // Load messages if user is logged in
                if (window.currentUserId) {
                    loadRecentMessages();
                    setInterval(loadRecentMessages, 30000);
                    setInterval(updateUnreadCount, 30000);
                }

                // Add click handler for category dropdown toggle
                $('#categories a').on('click', function(e) {
                    e.preventDefault();
                    $('.dropdown-content').toggle();
                });

                // Close dropdown when clicking outside
                $(document).on('click', function(e) {
                    if (!$(e.target).closest('.dropdown').length) {
                        $('.dropdown-content').hide();
                    }
                });
            });

            // Load categories in dropdown
            function loadCategoriesInDropdown() {
                $.ajax({
                    url: '/kaif_evibe/templates/php/get_categories_with_events.php',
                    method: 'GET',
                    success: function(response) {
                        if (response.success) {
                            const dropdown = $('#categoryDropdown');
                            dropdown.empty();
                            
                            // Add "All" option first
                            dropdown.append(`
                                <a href="javascript:void(0)" class="category-link" data-category="all">
                                    <i class="fas fa-th-large"></i>
                                    <span>All Events</span>
                                    <span class="event-count">${response.total_events || 0}</span>
                                </a>
                            `);
                            
                            // Add categories
                            response.categories.forEach(category => {
                                dropdown.append(`
                                    <a href="javascript:void(0)" class="category-link" data-category="${category.category_id}">
                                        <i class="${category.icon || 'fas fa-tag'}"></i>
                                        <span>${category.name}</span>
                                        <span class="event-count">${category.event_count || 0}</span>
                                    </a>
                                `);
                            });

                            // Add click handlers for category links
                            $('.category-link').off('click').on('click', function(e) {
                                e.preventDefault();
                                const categoryId = $(this).data('category');
                                console.log('Category clicked:', categoryId);
                                
                                // Update active state
                                $('.category-link').removeClass('active');
                                $(this).addClass('active');
                                
                                if (categoryId === 'all') {
                                    console.log('Loading all events...');
                                    loadFeaturedEvents();
                                } else {
                                    console.log('Loading events for category:', categoryId);
                                    loadEventsByCategory(categoryId);
                                }
                                $('.dropdown-content').hide();
                            });
                        } else {
                            console.error('Error loading categories:', response.message);
                        }
                    },
                    error: function(xhr, status, error) {
                        console.error('Error loading categories:', error);
                    }
                });
            }

            // Function to load events by category
            function loadEventsByCategory(categoryId) {
                console.log('Loading events for category:', categoryId);
                const container = $('#featuredEventsContainer');
                if (!container.length) {
                    console.error('Featured events container not found');
                    return;
                }

                // Show loading state
                container.html('<div class="loading-indicator"><i class="fas fa-spinner fa-pulse"></i><p>Loading events...</p></div>');

                // Convert categoryId to integer if it's not 'all'
                const categoryIdInt = categoryId === 'all' ? 0 : parseInt(categoryId);
                
                $.ajax({
                    url: '/kaif_evibe/templates/php/get_events_by_category.php',
                    method: 'GET',
                    data: { category_id: categoryIdInt },
                    success: function(response) {
                        console.log('Category events response:', response);
                        if (response.success && response.events) {
                            container.empty();
                            
                            // Update the title to show category name
                            const categoryName = $('.category-link.active').find('span').text();
                            $('.featured-events h2').text(categoryName + ' Events');
                            
                            if (response.events.length === 0) {
                                container.html('<p class="no-events-message">No events found in this category.</p>');
                                return;
                            }
                            
                            const $grid = $('<div class="event-grid"></div>');
                            response.events.forEach(event => {
                                console.log('Creating card for event:', event);
                                $grid.append(createEventCard(event));
                                checkFavoriteStatus(event.event_id);
                            });
                            container.append($grid);
                        } else {
                            console.error('Error loading category events:', response.message);
                            container.html('<p class="error-message">' + (response.message || 'No events found in this category.') + '</p>');
                        }
                    },
                    error: function(xhr, status, error) {
                        console.error('Error loading category events:', error);
                        console.error('Status:', status);
                        console.error('Response:', xhr.responseText);
                        container.html('<p class="error-message">Error loading events. Please try again later.</p>');
                    }
                });
            }
        });

        function displayEvents(events, container) {
            const $container = $(container);
            $container.empty();

            events.forEach(event => {
                const eventCard = `
                    <div class="event-card">
                        <div class="event-image">
                            <img src="${event.image_url || '../images/default-event.jpg'}" alt="${event.title}">
                            <button class="favorite-btn" onclick="toggleFavorite(${event.event_id})">
                                <i class="far fa-heart"></i>
                            </button>
                        </div>
                        <div class="event-details">
                            <div class="event-header">
                                <span class="event-category">${event.category || 'General'}</span>
                                <span class="event-date">${event.formatted_date}</span>
                            </div>
                            <h3 class="event-title">${event.title}</h3>
                            <div class="event-organizer">
                                <i class="fas fa-user"></i>
                                <span>${event.organizer_name || 'Unknown Organizer'}</span>
                            </div>
                            <div class="event-location">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>${event.venue || 'Venue not specified'}</span>
                            </div>
                            <div class="event-price">$${event.price || '0.00'}</div>
                            <div class="event-rating">
                                <div class="stars">
                                    ${generateStars(event.rating || 0)}
                                </div>
                                <span class="rating-count">(${event.rating_count || 0})</span>
                            </div>
                            <div class="event-actions">
                                <a href="event_details.html?id=${event.event_id}" class="view-btn">
                                    <i class="fas fa-eye"></i> View Details
                                </a>
                                <button class="book-btn" onclick="bookEvent(${event.event_id})">
                                    <i class="fas fa-ticket-alt"></i> Book Now
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                $container.append(eventCard);
            });
        }

        function generateStars(rating) {
            let stars = '';
            for (let i = 1; i <= 5; i++) {
                if (i <= rating) {
                    stars += '<i class="fas fa-star"></i>';
                } else if (i - 0.5 <= rating) {
                    stars += '<i class="fas fa-star-half-alt"></i>';
                } else {
                    stars += '<i class="far fa-star"></i>';
                }
            }
            return stars;
        }

        // Function to check if an event is favorited
        function checkFavoriteStatus(eventId) {
            $.ajax({
                url: '/kaif_evibe/templates/php/check_favorite_status.php',
                method: 'POST',
                data: { event_id: eventId },
                success: function(response) {
                    if (response.success) {
                        const $btn = $(`.favorite-btn[data-event-id="${eventId}"]`);
                        const $icon = $btn.find('.favorite-icon');
                        
                        if (response.is_favorite) {
                            $btn.addClass('active');
                            $icon.css('filter', 'brightness(0) invert(1)');
                        } else {
                            $btn.removeClass('active');
                            $icon.css('filter', 'none');
                        }
                    }
                }
            });
        }

        // Function to toggle favorite status
        function toggleFavorite(eventId) {
            const $btn = $(`.favorite-btn[data-event-id="${eventId}"]`);
            const $icon = $btn.find('.favorite-icon');
            const $favCount = $('#totalFavorites');
            const currentCount = parseInt($favCount.text()) || 0;
            
            // Show loading state
            $btn.addClass('loading');
            $icon.css('opacity', '0.5');

            $.ajax({
                url: '/kaif_evibe/templates/php/toggle_favorite.php',
                method: 'POST',
                data: { event_id: eventId },
                success: function(response) {
                    if (response.success) {
                        if (response.is_favorite) {
                            // Event is now favorited
                            $btn.addClass('active');
                            $icon.css('filter', 'brightness(0) invert(1)');
                            showNotification('Event added to favorites!', 'success');
                            // Increment favorite count
                            $favCount.text(currentCount + 1);
                        } else {
                            // Event is now unfavorited
                            $btn.removeClass('active');
                            $icon.css('filter', 'none');
                            showNotification('Event removed from favorites', 'info');
                            // Decrement favorite count
                            $favCount.text(Math.max(0, currentCount - 1));
                        }
                    } else {
                        console.error('Error toggling favorite:', response.message);
                        showNotification('Error: ' + response.message, 'error');
                    }
                },
                error: function(xhr, status, error) {
                    console.error('Error:', error);
                    showNotification('Error toggling favorite. Please try again.', 'error');
                },
                complete: function() {
                    // Remove loading state
                    $btn.removeClass('loading');
                    $icon.css('opacity', '1');
                }
            });
        }

        // Function to show notifications
        function showNotification(message, type = 'info') {
            const $notification = $(`
                <div class="notification ${type}">
                    <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `);
            
            $('body').append($notification);
            
            // Remove notification after 3 seconds
            setTimeout(() => {
                $notification.fadeOut(300, function() {
                    $(this).remove();
                });
            }, 3000);
        }

        function bookEvent(eventId) {
            window.location.href = `book_event.html?id=${eventId}`;
        }

        function viewEvent(eventId) {
            // First record this view in the database
            $.ajax({
                url: '/kaif_evibe/templates/php/record_event_view.php',
                method: 'POST',
                data: { event_id: eventId },
                success: function(response) {
                    console.log('View recorded:', response);
                    // Then redirect to the event page
                    window.location.href = `view_event_user.html?id=${eventId}`;
                },
                error: function(xhr, status, error) {
                    console.error('Error recording view:', error);
                    // Still redirect even if recording fails
                    window.location.href = `view_event_user.html?id=${eventId}`;
                }
            });
        }

        function messageOrganizer(eventId) {
            openMessageModal(eventId);
        }

        // Global message handling functions
        function openMessageModal(eventId) {
            document.getElementById('eventId').value = eventId;
            document.getElementById('messageModal').style.display = 'block';
            loadEventMessages(eventId);
            loadEventDetails(eventId);
        }

        function loadEventDetails(eventId) {
            $.ajax({
                url: '../php/get_event_details.php',
                method: 'GET',
                data: { event_id: eventId },
                success: function(response) {
                    if (response.success) {
                        $('#chatEventTitle').text('Event: ' + response.event.title);
                        $('#chatEventDate').text('Date: ' + response.event.formatted_date);
                    }
                }
            });
        }

        function loadEventMessages(eventId) {
            $.ajax({
                url: '../php/get_event_messages.php',
                method: 'GET',
                data: { event_id: eventId },
                success: function(response) {
                    if (response.success) {
                        displayMessages(response.messages);
                    }
                }
            });
        }

        function displayMessages(messages) {
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML = '';

            messages.forEach(message => {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${message.is_sender ? 'sent' : 'received'}`;
                
                const messageContent = document.createElement('div');
                messageContent.className = 'message-content';
                messageContent.textContent = message.message;
                
                const messageMeta = document.createElement('div');
                messageMeta.className = 'message-meta';
                messageMeta.innerHTML = `
                    <span>${message.sender_name}</span>
                    <span>${new Date(message.created_at).toLocaleString()}</span>
                `;
                
                messageDiv.appendChild(messageContent);
                messageDiv.appendChild(messageMeta);
                chatMessages.appendChild(messageDiv);
            });

            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function closeMessageModal() {
            document.getElementById('messageModal').style.display = 'none';
            $('#messageText').val('');
        }

        // Add event listeners for the close button
        document.getElementById('closeMessageModal').addEventListener('click', closeMessageModal);

        // Close modal when clicking outside
        document.getElementById('messageModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeMessageModal();
            }
        });

        // Handle message form submission
        $('#messageForm').on('submit', function(e) {
            e.preventDefault();
            
            const eventId = $('#eventId').val();
            const message = $('#messageText').val();

            $.ajax({
                url: '../php/send_message.php',
                method: 'POST',
                data: {
                    event_id: eventId,
                    message: message
                },
                success: function(response) {
                    if (response.success) {
                        $('#messageText').val('');
                        loadEventMessages(eventId);
                    } else {
                        alert('Error: ' + response.message);
                    }
                },
                error: function() {
                    alert('Error sending message. Please try again.');
                }
            });
        });

        // Add message modal styles
        const style = document.createElement('style');
        style.textContent = `
            .modal {
                display: none;
                position: fixed;
                z-index: 1000;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0,0,0,0.7);
            }

            .modal-content {
                background-color: #1a1a1a;
                margin: 2% auto;
                padding: 20px;
                border-radius: 8px;
                width: 80%;
                max-width: 800px;
                height: 90vh;
                display: flex;
                flex-direction: column;
                position: relative;
            }

            .chat-header {
                padding-bottom: 15px;
                border-bottom: 1px solid #333;
                margin-bottom: 15px;
            }

            .chat-header h2 {
                color: #ffcc00;
                margin: 0;
            }

            .chat-info {
                display: flex;
                justify-content: space-between;
                color: #aaa;
                font-size: 0.9em;
                margin-top: 5px;
            }

            .chat-container {
                flex: 1;
                display: flex;
                flex-direction: column;
                overflow: hidden;
            }

            .chat-messages {
                flex: 1;
                overflow-y: auto;
                padding: 15px;
                background: rgba(0,0,0,0.3);
                border-radius: 8px;
                margin-bottom: 15px;
            }

            .message {
                margin-bottom: 15px;
                max-width: 80%;
            }

            .message.sent {
                margin-left: auto;
                background: #2196F3;
                color: white;
                padding: 10px 15px;
                border-radius: 15px;
                border-bottom-right-radius: 0;
            }

            .message.received {
                margin-right: auto;
                background: #333;
                color: white;
                padding: 10px 15px;
                border-radius: 15px;
                border-bottom-left-radius: 0;
            }

            .message-meta {
                font-size: 0.8em;
                color: #aaa;
                margin-top: 5px;
            }

            .chat-input-container {
                padding: 15px;
                background: rgba(0,0,0,0.3);
                border-radius: 8px;
            }

            #messageForm {
                display: flex;
                gap: 10px;
            }

            #messageText {
                flex: 1;
                padding: 10px;
                border-radius: 4px;
                background: #2a2a2a;
                color: white;
                border: 1px solid #444;
                resize: none;
                height: 50px;
            }

            .send-btn {
                background: #2196F3;
                color: white;
                padding: 10px 20px;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                display: flex;
                align-items: center;
                gap: 5px;
            }

            .send-btn:hover {
                background: #1976D2;
            }

            #closeMessageModal {
                position: absolute;
                right: 20px;
                top: 20px;
                color: #aaa;
                font-size: 28px;
                font-weight: bold;
                cursor: pointer;
            }

            #closeMessageModal:hover {
                color: white;
            }
        `;
        document.head.appendChild(style);
    </script>

    <style>
    /* Card Styles */
    .card {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 20px;
        margin: 10px;
        width: 300px;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
    }
    #price-kaif{
        color: #ffcc00;
        
    }
    #User-price{
        font-size: 20px;
        margin-top: 10px;
    }
    .card-icon {
        font-size: 2.5rem;
        color: #4CAF50;
        margin-bottom: 15px;
    }

    .card h3 {
        color: #fff;
        font-size: 1.5rem;
        margin-bottom: 10px;
    }

    .card p {
        color: rgba(255, 255, 255, 0.8);
        margin-bottom: 20px;
    }

    .card-stats {
        background: rgba(255, 255, 255, 0.1);
        padding: 10px;
        border-radius: 8px;
        margin-bottom: 15px;
    }

    .card-stats span {
        color: #fff;
        font-size: 0.9rem;
    }

    .card-link {
        display: inline-block;
        background: #4CAF50;
        color: white;
        padding: 10px 20px;
        border-radius: 5px;
        text-decoration: none;
        transition: background 0.3s ease;
    }

    .card-link:hover {
        background: #45a049;
    }

    .cards-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 20px;
        padding: 20px;
    }

    /* Event Grid Styles */
    .event-grid {
       display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
    padding: 0 2rem;
    margin: 2rem 0;
      }
    

    .featured-events h2, .trending-events h2 {
        text-align: center;
        color: #fff;
        font-size: 2rem;
        margin: 30px 0;
        position: relative;
        padding-bottom: 10px;
    }

    .featured-events h2:after, .trending-events h2:after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 100px;
        height: 3px;
        background: #4CAF50;
    }

    .event-card {
        background: rgba(0, 0, 0, 0.5) !important;
        backdrop-filter: blur(10px) !important;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: #fff !important;
        margin-bottom: 15px;
       
    }
    
    .event-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        border-color: rgba(255, 204, 0, 0.3);
    }

    .event-image {
        width: 100%;
        height: 200px;
        object-fit: cover;
    }

    .event-content {
        padding: 15px;
    }

    .event-title {
        color: #ffcc00;
        font-size: 1.2rem;
        margin-bottom: 10px;
    }
    
    .event-info {
        color: rgba(255, 255, 255, 0.8);
        font-size: 15px;
        margin-bottom: 15px;
        margin-left: 10px;
    }
    .event-info p i{
        color : #ffcc00;
    }
    .event-actions {
        display: flex;
        gap: 8px;
        margin-top: 10px;
    }

    .event-actions button {
        width: 100%;
        padding: 6px 12px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: 0.3s;
        font-size: 0.9rem;
    }

    .btn-book {
        background: #ffcc00;
        color: white;
    }

    .btn-book:hover {
        background: #e6b800;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .btn-view {
        background:#4CAF50;
        color: white;
    }

    .btn-view:hover {
        background: #388E3;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .message-btn {
        background: #2196F3;
        color: white;
        position: relative;
    }

    .message-btn:hover {
        background: #1976D2;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .unread-badge {
        position: absolute;
        top: -8px;
        right: -8px;
        background: #FF5722;
        color: white;
        font-size: 0.75rem;
        font-weight: 600;
        padding: 2px 6px;
        border-radius: 10px;
        min-width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    /* Responsive button styles */
    @media (max-width: 768px) {
        .event-actions {
            flex-direction: column;
            width: 100%;
        }

        .btn-book, .btn-view, .message-btn {
            width: 100%;
            margin-bottom: 8px;
        }
    }

    /* Categories Section Styles */
    .categories-section {
        margin: 30px 0;
        padding: 20px;
    }

    .categories-section h2 {
        text-align: center;
        color: #fff;
        font-size: 2rem;
        margin-bottom: 30px;
        position: relative;
        padding-bottom: 10px;
    }

    .categories-section h2:after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 100px;
        height: 3px;
        background: #4CAF50;
    }

    .categories-bar {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 15px;
        margin-bottom: 30px;
        overflow-x: auto;
        white-space: nowrap;
        scrollbar-width: none;
        -ms-overflow-style: none;
    }

    .categories-bar::-webkit-scrollbar {
        display: none;
    }

    .categories-scroll {
        display: flex;
        gap: 15px;
        padding: 5px;
    }

    .category-tab {
        background: rgba(255, 255, 255, 0.1);
        color: #fff;
        padding: 15px 25px;
        border-radius: 25px;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 1px solid rgba(255, 255, 255, 0.2);
        display: flex;
        align-items: center;
        gap: 10px;
        min-width: 150px;
        justify-content: center;
    }

    .category-tab:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: translateY(-2px);
    }

    .category-tab.active {
        background: #4CAF50;
        color: white;
    }

    .category-tab i {
        font-size: 1.2rem;
    }

    .category-tab .event-count {
        background-color: rgba(255, 255, 255, 0.2);
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 0.8rem;
        margin-left: 5px;
    }

    .category-events-container {
        display: none;
    }

    .category-events-container.active {
        display: block;
    }

    .category-events-grid {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 20px;
        padding: 20px;
    }

    .no-events-message {
        text-align: center;
        color: rgba(255, 255, 255, 0.8);
        font-size: 1.2rem;
        padding: 40px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        margin: 20px;
    }

    .event-image-container {
        position: relative;
        width: 100%;
    }

    .favorite-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        background: rgba(255, 255, 255, 0.8);
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        z-index: 2;
    }

    .favorite-btn:hover {
        background: rgba(255, 255, 255, 1);
        transform: scale(1.1);
    }

    .favorite-icon {
        width: 20px;
        height: 20px;
        object-fit: contain;
        transition: all 0.3s ease;
    }

    .favorite-btn.active {
        background: #ffcc00;
    }

    .favorite-btn.active .favorite-icon {
        filter: brightness(0) invert(1);
    }

    /* Add these new styles */
    .event-title-container {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 10px;
    }

    .title-heart-icon {
        width: 16px;
        height: 16px;
        object-fit: contain;
    }

    /* Add these styles for notifications and loading state */
    .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 25px;
        border-radius: 5px;
        background: rgba(255, 255, 255, 0.9);
        color: #333;
        display: flex;
        align-items: center;
        gap: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        animation: slideIn 0.3s ease-out;
    }
    
    .notification.success {
        background: rgba(76, 175, 80, 0.9);
        color: white;
    }
    
    .notification.error {
        background: rgba(244, 67, 54, 0.9);
        color: white;
    }
    
    .notification.info {
        background: rgba(33, 150, 243, 0.9);
        color: white;
    }
    
    @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    
    .favorite-btn.loading {
        pointer-events: none;
    }
    
    .favorite-btn.loading .favorite-icon {
        animation: pulse 1s infinite;
    }
    
    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.2); }
        100% { transform: scale(1); }
    }

    /* Update dropdown styles */
    .dropdown {
        position: relative;
        display: inline-block;
    }

    .dropdown-toggle {
        cursor: pointer;
    }

    .dropdown-content {
        display: none;
        position: absolute;
        background-color: #1a1a1a;
        min-width: 250px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        z-index: 1000;
        border-radius: 8px;
        top: 100%;
        left: 0;
        border: 1px solid rgba(255, 255, 255, 0.2);
        margin-top: 5px;
        padding: 10px 0;
    }

    .dropdown-content.show {
        display: block;
    }

    .dropdown-content a {
        color: #fff;
        padding: 12px 16px;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 10px;
        transition: all 0.3s ease;
        border-radius: 4px;
        margin: 0 10px;
    }

    .dropdown-content a:hover {
        background-color: rgba(255, 255, 255, 0.1);
        transform: translateX(5px);
    }

    .dropdown-content a.active {
        background-color: rgba(76, 175, 80, 0.2);
    }

    .dropdown-content a i {
        width: 20px;
        text-align: center;
    }

    .dropdown-content a span:first-of-type {
        flex: 1;
    }

    .event-count {
        background-color: rgba(255, 255, 255, 0.1);
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 12px;
        margin-left: 10px;
    }

    .loading-indicator {
        padding: 20px;
        text-align: center;
        color: rgba(255, 255, 255, 0.8);
    }

    .loading-indicator i {
        font-size: 1.5rem;
        margin-bottom: 10px;
    }

    .loading-indicator p {
        font-size: 0.9rem;
    }

    /* Carousel Slider Styles */
    .carousel-container {
        position: relative;
        width: 90%;
        max-width: 1200px;
        height: 400px;
        margin: 30px auto;
        overflow: hidden;
        border-radius: 15px;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
    }

    .carousel-slider {
        display: flex;
        width: 100%;
        height: 100%;
        transition: transform 0.5s ease-in-out;
    }

    .carousel-slide {
        flex: 0 0 100%;
        position: relative;
        overflow: hidden;
    }

    .carousel-slide img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
    }

    .carousel-slide:hover img {
        transform: scale(1.05);
    }

    .carousel-caption {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        padding: 20px;
        background: linear-gradient(to top, rgba(0, 0, 0, 0.8), transparent);
        color: white;
        text-align: left;
    }

    .carousel-caption h3 {
        font-size: 1.8rem;
        margin-bottom: 5px;
    }

    .carousel-caption p {
        font-size: 1rem;
        opacity: 0.9;
    }

    .carousel-btn {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 50px;
        height: 50px;
        background: rgba(0, 0, 0, 0.5);
        color: white;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        font-size: 1.2rem;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        z-index: 10;
    }

    .carousel-btn:hover {
        background: rgba(0, 0, 0, 0.8);
    }

    .prev-btn {
        left: 20px;
    }

    .next-btn {
        right: 20px;
    }

    .carousel-dots {
        position: absolute;
        bottom: 15px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 10px;
    }

    .carousel-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.5);
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .carousel-dot.active {
        background: #fff;
        transform: scale(1.2);
    }

    .carousel-loading {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.1);
        color: white;
    }

    .carousel-loading i {
        font-size: 3rem;
        margin-bottom: 15px;
    }

    @media (max-width: 768px) {
        .carousel-container {
            height: 300px;
        }
        
        .carousel-caption h3 {
            font-size: 1.4rem;
        }
        
        .carousel-btn {
            width: 40px;
            height: 40px;
            font-size: 1rem;
        }
    }

    /* Add these styles for the carousel link */
    .carousel-link {
        display: block;
        width: 100%;
        height: 100%;
        text-decoration: none;
        color: inherit;
        position: relative;
    }

    .carousel-link:hover {
        cursor: pointer;
    }

    .carousel-link img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
    }

    .carousel-link:hover img {
        transform: scale(1.05);
    }

    .profile-image-container {
        position: relative;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        overflow: hidden;
        margin-right: 10px;
    }

    .profile-image-container img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .profile-image-upload {
        position: absolute;
        bottom: 0;
        right: 0;
        background: rgba(0, 0, 0, 0.5);
        color: white;
        width: 25px;
        height: 25px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .profile-image-upload:hover {
        background: rgba(0, 0, 0, 0.7);
    }

    .profile-image-container img.loading {
        opacity: 0.5;
    }

    .profile-image-container img.loading::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 20px;
        height: 20px;
        border: 2px solid #fff;
        border-radius: 50%;
        border-top-color: transparent;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        to { transform: translate(-50%, -50%) rotate(360deg); }
    }
    </style>
</body>
</html>